<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>在github基于个人或公司GitHub Pages部署hugo博客之三 | My New Hugo Site</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="使用自定义的actons workflow,在仓库的两个分支之间实现hugo博客站点自动化部署 使用github personal access token 和仓库的secrets在两个分支之间实现博客站点自动化部署 用仓库的main分支保存博客项目源文件，手动建立独立分支gh-pages保存编译后的静态文件。这里依然以username.github.io形式的仓库为例。自己手动建立独立的gh-pages分支。
在github上新建username.github.io形式的空仓
在本地根据hugo官网推荐的QuickStart入门教程，建立Hugo博客项目
hugo new site hugo cd hugo git init git submodule add https://github.com/theNewDynamic/gohugo-theme-ananke.git themes/ananke 编辑config.toml文件，在最后新增 theme = &#34;ananke&#34; 修改baseURL = &#34;https://username.github.io&#34; hugo new posts/文档名称作为目录名/index.md --编辑自己的文档 git add . git commit -m &#34;新增文档&#34; git push -u origin main --第一次推送到空仓username.github.io时要带上-u参数，以后不需要带-u参数 在本地新建一个独立分支gh-pages
git checkout --orphan gh-pages echo &#34;hello github gh-pages&#34; > readme.md git add . git commit -m &#34;add gh-pages branch&#34; git push origin gh-pages --在新建分支后推送到远程仓库分支，要指定源分支，系统会自动建立同名分支，并建立关联。以后再推送分支可以不必再指定源分支。 git branch -a --此时就可以看到新建的独立分支gh-pages。如果不在新建的分支下增加变化并git-add-commit-push ，就不会真正建立分支。 经过上面两个步骤，username."><meta name=generator content="Hugo 0.105.0"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/ananke/css/main.min.css><meta property="og:title" content="在github基于个人或公司GitHub Pages部署hugo博客之三"><meta property="og:description" content="使用自定义的actons workflow,在仓库的两个分支之间实现hugo博客站点自动化部署 使用github personal access token 和仓库的secrets在两个分支之间实现博客站点自动化部署 用仓库的main分支保存博客项目源文件，手动建立独立分支gh-pages保存编译后的静态文件。这里依然以username.github.io形式的仓库为例。自己手动建立独立的gh-pages分支。
在github上新建username.github.io形式的空仓
在本地根据hugo官网推荐的QuickStart入门教程，建立Hugo博客项目
hugo new site hugo cd hugo git init git submodule add https://github.com/theNewDynamic/gohugo-theme-ananke.git themes/ananke 编辑config.toml文件，在最后新增 theme = &#34;ananke&#34; 修改baseURL = &#34;https://username.github.io&#34; hugo new posts/文档名称作为目录名/index.md --编辑自己的文档 git add . git commit -m &#34;新增文档&#34; git push -u origin main --第一次推送到空仓username.github.io时要带上-u参数，以后不需要带-u参数 在本地新建一个独立分支gh-pages
git checkout --orphan gh-pages echo &#34;hello github gh-pages&#34; > readme.md git add . git commit -m &#34;add gh-pages branch&#34; git push origin gh-pages --在新建分支后推送到远程仓库分支，要指定源分支，系统会自动建立同名分支，并建立关联。以后再推送分支可以不必再指定源分支。 git branch -a --此时就可以看到新建的独立分支gh-pages。如果不在新建的分支下增加变化并git-add-commit-push ，就不会真正建立分支。 经过上面两个步骤，username."><meta property="og:type" content="article"><meta property="og:url" content="http://lsgxs2022.github.io/posts/%E5%9C%A8github%E5%9F%BA%E4%BA%8E%E4%B8%AA%E4%BA%BA%E6%88%96%E5%85%AC%E5%8F%B8githubpages%E9%83%A8%E7%BD%B2hugo%E5%8D%9A%E5%AE%A2%E4%B9%8B%E4%B8%89/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-15T20:02:48+08:00"><meta property="article:modified_time" content="2022-11-15T20:02:48+08:00"><meta itemprop=name content="在github基于个人或公司GitHub Pages部署hugo博客之三"><meta itemprop=description content="使用自定义的actons workflow,在仓库的两个分支之间实现hugo博客站点自动化部署 使用github personal access token 和仓库的secrets在两个分支之间实现博客站点自动化部署 用仓库的main分支保存博客项目源文件，手动建立独立分支gh-pages保存编译后的静态文件。这里依然以username.github.io形式的仓库为例。自己手动建立独立的gh-pages分支。
在github上新建username.github.io形式的空仓
在本地根据hugo官网推荐的QuickStart入门教程，建立Hugo博客项目
hugo new site hugo cd hugo git init git submodule add https://github.com/theNewDynamic/gohugo-theme-ananke.git themes/ananke 编辑config.toml文件，在最后新增 theme = &#34;ananke&#34; 修改baseURL = &#34;https://username.github.io&#34; hugo new posts/文档名称作为目录名/index.md --编辑自己的文档 git add . git commit -m &#34;新增文档&#34; git push -u origin main --第一次推送到空仓username.github.io时要带上-u参数，以后不需要带-u参数 在本地新建一个独立分支gh-pages
git checkout --orphan gh-pages echo &#34;hello github gh-pages&#34; > readme.md git add . git commit -m &#34;add gh-pages branch&#34; git push origin gh-pages --在新建分支后推送到远程仓库分支，要指定源分支，系统会自动建立同名分支，并建立关联。以后再推送分支可以不必再指定源分支。 git branch -a --此时就可以看到新建的独立分支gh-pages。如果不在新建的分支下增加变化并git-add-commit-push ，就不会真正建立分支。 经过上面两个步骤，username."><meta itemprop=datePublished content="2022-11-15T20:02:48+08:00"><meta itemprop=dateModified content="2022-11-15T20:02:48+08:00"><meta itemprop=wordCount content="262"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="在github基于个人或公司GitHub Pages部署hugo博客之三"><meta name=twitter:description content="使用自定义的actons workflow,在仓库的两个分支之间实现hugo博客站点自动化部署 使用github personal access token 和仓库的secrets在两个分支之间实现博客站点自动化部署 用仓库的main分支保存博客项目源文件，手动建立独立分支gh-pages保存编译后的静态文件。这里依然以username.github.io形式的仓库为例。自己手动建立独立的gh-pages分支。
在github上新建username.github.io形式的空仓
在本地根据hugo官网推荐的QuickStart入门教程，建立Hugo博客项目
hugo new site hugo cd hugo git init git submodule add https://github.com/theNewDynamic/gohugo-theme-ananke.git themes/ananke 编辑config.toml文件，在最后新增 theme = &#34;ananke&#34; 修改baseURL = &#34;https://username.github.io&#34; hugo new posts/文档名称作为目录名/index.md --编辑自己的文档 git add . git commit -m &#34;新增文档&#34; git push -u origin main --第一次推送到空仓username.github.io时要带上-u参数，以后不需要带-u参数 在本地新建一个独立分支gh-pages
git checkout --orphan gh-pages echo &#34;hello github gh-pages&#34; > readme.md git add . git commit -m &#34;add gh-pages branch&#34; git push origin gh-pages --在新建分支后推送到远程仓库分支，要指定源分支，系统会自动建立同名分支，并建立关联。以后再推送分支可以不必再指定源分支。 git branch -a --此时就可以看到新建的独立分支gh-pages。如果不在新建的分支下增加变化并git-add-commit-push ，就不会真正建立分支。 经过上面两个步骤，username."></head><body class="ma0 avenir bg-near-white"><header class="cover bg-top" style=background-image:url(/posts/%E5%9C%A8github%E5%9F%BA%E4%BA%8E%E4%B8%AA%E4%BA%BA%E6%88%96%E5%85%AC%E5%8F%B8githubpages%E9%83%A8%E7%BD%B2hugo%E5%8D%9A%E5%AE%A2%E4%B9%8B%E4%B8%89/image/%E5%86%B0%E5%B1%B1.jpg)><div class=bg-black-60><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">My New Hugo Site</a><div class="flex-l items-center"><div class=ananke-socials></div></div></div></nav><div class="tc-l pv6 ph3 ph4-ns"><div class="f2 f1-l fw2 white-90 mb0 lh-title">在github基于个人或公司GitHub Pages部署hugo博客之三</div></div></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">POSTS</aside><div id=sharing class="mt3 ananke-socials"></div><h1 class="f1 athelas mt3 mb1">在github基于个人或公司GitHub Pages部署hugo博客之三</h1><time class="f6 mv4 dib tracked" datetime=2022-11-15T20:02:48+08:00>November 15, 2022</time></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><h4 id=使用自定义的actons-workflow在仓库的两个分支之间实现hugo博客站点自动化部署>使用自定义的actons workflow,在仓库的两个分支之间实现hugo博客站点自动化部署</h4><h5 id=使用github-personal-access-token-和仓库的secrets在两个分支之间实现博客站点自动化部署><strong>使用github personal access token 和仓库的secrets在两个分支之间实现博客站点自动化部署</strong></h5><p>用仓库的main分支保存博客项目源文件，手动建立独立分支gh-pages保存编译后的静态文件。这里依然以username.github.io形式的仓库为例。自己手动建立独立的gh-pages分支。</p><ul><li><p>在github上新建username.github.io形式的空仓</p></li><li><p>在本地根据hugo官网推荐的QuickStart入门教程，建立Hugo博客项目</p><pre tabindex=0><code class=language-· data-lang=·>hugo  new   site  hugo
cd hugo 
git  init
git  submodule add https://github.com/theNewDynamic/gohugo-theme-ananke.git  themes/ananke
编辑config.toml文件，在最后新增  theme  =  &#34;ananke&#34;
修改baseURL = &#34;https://username.github.io&#34;
hugo  new  posts/文档名称作为目录名/index.md    --编辑自己的文档
git  add .
git  commit -m   &#34;新增文档&#34;
git  push  -u origin  main --第一次推送到空仓username.github.io时要带上-u参数，以后不需要带-u参数
</code></pre></li><li><p>在本地新建一个独立分支gh-pages</p><pre tabindex=0><code>git  checkout  --orphan gh-pages
echo  &#34;hello github gh-pages&#34; &gt; readme.md 
git  add .
git commit -m &#34;add gh-pages branch&#34;
git push origin gh-pages   --在新建分支后推送到远程仓库分支，要指定源分支，系统会自动建立同名分支，并建立关联。以后再推送分支可以不必再指定源分支。
git  branch -a   --此时就可以看到新建的独立分支gh-pages。如果不在新建的分支下增加变化并git-add-commit-push ，就不会真正建立分支。
</code></pre><p>经过上面两个步骤，username.githbu.io仓库有两个分支：main 、gh-pages。建立并切换到gh-pages分支时，会自动复制main分支的目录和文件，除了.git目录之外，把所有其他目录和文件都删除，然后git-add-commit-push，远程仓库的gh-pages没有别的文件，只用来保存静态的博客站点网页文件。</p></li><li><p>设置github-token和仓库的action secrets</p><ul><li>这里使用github账户下setting的 personal access tokens作为发布秘钥，在源文件仓库（执行 Github Actions 的仓库）私钥里读取这个token。</li></ul><p><img src=image/personal-access-token.png alt>
生成新的tokens之后，立刻复制保存在记事本里。</p><ul><li><p>选择仓库的settings,选择Secrets,Actions，添加仓库Secret,名称设置为：HUGODEPLOYTEST，内容复制前面新生成的token值。</p><p><img src=image/repository-actions-secrets.png alt></p></li></ul></li><li><p>在博客项目根目录下建立一个actions workflow文件(如果新建.github目录时提示不能建立，就从别处复制一个)，路径为：.github/workflows/hugo.yml ,文件内容如下（https://gohugo.io/hosting-and-deployment/hosting-on-github/，这里的action内容来自hugo官网）</p><pre tabindex=0><code>name: github pages

on:
  push:
    branches:
      - main  # Set a branch to deploy
  pull_request:

jobs:
  deploy:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v3
        with:
          submodules: true  # Fetch Hugo themes (true OR recursive)
          fetch-depth: 0    # Fetch all history for .GitInfo and .Lastmod

      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v2
        with:
          hugo-version: &#39;latest&#39;
          # extended: true

      - name: Build
        run: hugo --minify

      - name: Deploy
        uses: peaceiris/actions-gh-pages@v3
        if: github.ref == &#39;refs/heads/main&#39;
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }} 
          publish_dir: ./public
</code></pre><p><a href=https://gohugo.io/hosting-and-deployment/hosting-on-github/#github-pages-setting>GitHub pages setting</a></p><pre tabindex=0><code>GitHub pages setting

By default, the GitHub action pushes the generated content to the gh-pages branch. This means GitHub has to serve your gh-pages branch as a GitHub Pages branch. You can change this setting by going to Settings &gt; GitHub Pages, and change the source branch to gh-pages.
Change baseURL in config.toml

Don’t forget to rename your baseURL in config.toml with the value https://&lt;USERNAME&gt;.github.io for your user repository or https://&lt;USERNAME&gt;.github.io/&lt;REPOSITORY_NAME&gt; for a project repository.

Unless this is present in your config.toml, your website won’t work.
</code></pre></li><li><p>最后推送整个博客项目到username.github.io仓库的main分支，github后台会自动运行上面的actions workflows文件，完成博客项目静态站点网页部署。由于已经使用了github推荐的hugo action，可以正确的自动化发布博客项目，所有这个workflows就没有再实际测试，记录在这里备忘，以后有兴趣的可以再尝试。</p></li></ul><ul class=pa0></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=http://lsgxs2022.github.io/>&copy; My New Hugo Site 2022</a><div><div class=ananke-socials></div></div></div></footer></body></html>